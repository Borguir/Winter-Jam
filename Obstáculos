extends Area2D

@export_enum("Obstaculo", "Rampa", "Moneda") var tipo_objeto: int = 0

var velo_y = 100
var velo_x = 10
var dificultad = 1.0
var direccion_x = 0 
var lado_izq = 80.0 
var lado_der = 100.0
var y_suelo_real = 0.0
var choque = 0

func _ready() -> void:
	scale = Vector2(0.1, 0.1)

	if position.x < lado_izq:
		direccion_x = -1
	if position.x > lado_der:
		direccion_x = 1

func _process(delta: float) -> void:
	var progreso = remap(position.y, 0, 320, 0.1, 1.2) 
	progreso = clamp(progreso, 0.1, 1.5)
	position.y += (velo_y * dificultad * progreso) * delta
	position.x += (velo_x * direccion_x) * dificultad * progreso * delta
	scale = Vector2(progreso, progreso)

	if position.y > 360:
		queue_free()

func _on_body_entered(body):
	if body.is_in_group("player"): #RAMPA
		if tipo_objeto == 1:
			if body.saltando:
				return
			if body.has_method("iniciar_qte"):
				body.iniciar_qte()
			
		elif tipo_objeto == 2: #MONEDA
			sumar_puntos_main(50)
			queue_free() 
			
		elif tipo_objeto == 0: #Obsta Culo
			if not body.saltando:
				var main_script = get_tree().current_scene
				if main_script.has_method("choques"):
					main_script.choques()
				queue_free()

func sumar_puntos_main(cantidad):
	var main_script = get_tree().current_scene
	if main_script.has_method("sumar_puntos"):
		main_script.sumar_puntos(cantidad)

func choques():
	choque += 1
